<!doctype html>





























<html
  class="not-ready lg:text-base"
  style="--bg: #faf8f1"
  lang="en-au"
>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, shrink-to-fit=no"
  />

  
  <title>Locally Debugging an Event Grid Triggered Azure Function with Postman - Blogilreavy</title>

  
  <meta name="theme-color" />

  
  
  
  
  <meta name="description" content="How to use Postman to locally debug an Azure Function that has an Event Grid Trigger." />
  <meta name="author" content="Blogilreavy" />
  

  
  
  
  
  
  
  <link rel="preload stylesheet" as="style" href="http://localhost:1313/main.min.css" />

  
  
  
  
  
  <link rel="preload" as="image" href="http://localhost:1313/theme.png" />

  
  
  
  
  

  
  
  

  
  
  <script
    defer
    src="http://localhost:1313/highlight.min.js"
    onload="hljs.initHighlightingOnLoad();"
  ></script>
  

  
  
  

  
  <link rel="icon" href="http://localhost:1313/favicon.ico" />
  <link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png" />

  
  <meta name="generator" content="Hugo 0.124.1">

  
  
  
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header class="mx-auto flex h-[4.5rem] max-w-3xl px-8 lg:justify-center">
  <div class="relative z-50 mr-auto flex items-center">
    <a
      class="-translate-x-[1px] -translate-y-[1px] text-2xl font-semibold"
      href="http://localhost:1313/"
      >Blogilreavy</a
    >
    <div
      class="btn-dark text-[0] ml-4 h-6 w-6 shrink-0 cursor-pointer [background:url(./theme.png)_left_center/_auto_theme('spacing.6')_no-repeat] [transition:_background-position_0.4s_steps(5)] dark:[background-position:right]"
      role="button"
      aria-label="Dark"
    ></div>
  </div>

  <div
    class="btn-menu relative z-50 -mr-8 flex h-[4.5rem] w-[5rem] shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
    role="button"
    aria-label="Menu"
  ></div>

  

  <script>
    
    const htmlClass = document.documentElement.classList;
    setTimeout(() => {
      htmlClass.remove('not-ready');
    }, 10);

    
    const btnMenu = document.querySelector('.btn-menu');
    btnMenu.addEventListener('click', () => {
      htmlClass.toggle('open');
    });

    
    const metaTheme = document.querySelector('meta[name="theme-color"]');
    const lightBg = '#faf8f1'.replace(/"/g, '');
    const setDark = (isDark) => {
      metaTheme.setAttribute('content', isDark ? '#000' : lightBg);
      htmlClass[isDark ? 'add' : 'remove']('dark');
      localStorage.setItem('dark', isDark);
    };

    
    const darkScheme = window.matchMedia('(prefers-color-scheme: dark)');
    if (htmlClass.contains('dark')) {
      setDark(true);
    } else {
      const darkVal = localStorage.getItem('dark');
      setDark(darkVal ? darkVal === 'true' : darkScheme.matches);
    }

    
    darkScheme.addEventListener('change', (event) => {
      setDark(event.matches);
    });

    
    const btnDark = document.querySelector('.btn-dark');
    btnDark.addEventListener('click', () => {
      setDark(localStorage.getItem('dark') !== 'true');
    });
  </script>

  <div
    class="nav-wrapper fixed inset-x-0 top-full z-40 flex h-full select-none flex-col justify-center pb-16 duration-200 dark:bg-black lg:static lg:h-auto lg:flex-row lg:!bg-transparent lg:pb-0 lg:transition-none"
  >
    
    

    
  </div>
</header>


    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl px-8 pb-16 pt-12 dark:prose-invert"
    >
      

<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Locally Debugging an Event Grid Triggered Azure Function with Postman</h1>

    
    <div class="text-sm antialiased opacity-60">
      
      <time>Feb 18, 2018</time>
      
      
      
      
    </div>
    
  </header>

  <section><p><strong>tl;dr</strong> <em>Just like you&rsquo;d expect but the trick is to add this header (which took me a long time to track down in the docs): <code>aeg-event-type</code> = <code>Notification</code></em></p>
<p>Azure Functions can be invoked in response to various different <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-triggers-bindings">trigger</a> types. In this post we&rsquo;ll look at how to locally debug an Azure Function that is configured with an <a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-bindings-event-grid">Event Grid trigger</a>.</p>
<p><a href="https://azure.microsoft.com/en-au/services/event-grid/">Azure Event Grid</a> is analogous to SNS (Simple Notification Service) in AWS. It offers a simple event system which operates on a push-push model (rather than push-pull). Event Grid uses <a href="https://docs.microsoft.com/en-us/azure/event-grid/concepts">topics</a>. Events are published to a topic and subscribers receive the events from the topic. This model facilitates reactive programming and works great with Azure Logic apps and Azure Functions.</p>
<p>Event Grid is deeply integrated into Azure. Many of Azure&rsquo;s services can publish events to an Event Grid topic. For example, a blob storage container can publish an event whenever an image is uploaded. An Azure Function could then subscribe to this event and be used to resize and compress the image.</p>
<p>Anyway, since an Event Grid topic is not something that can be run locally, it can make debugging the Azure Function that subscribes to a topic a bit challenging at times. First let&rsquo;s quickly look at the structure of an event.</p>
<h2 id="structure-of-an-event-grid-event">Structure of an Event Grid Event</h2>
<p>Event Grid has support for two event schemas: <a href="https://docs.microsoft.com/en-us/azure/event-grid/event-schema">Event Grid Schema</a> and the <a href="https://docs.microsoft.com/en-us/azure/event-grid/cloudevents-schema">Cloud Event Schema</a>. For the purposes of this post we&rsquo;ll focus on the Event Grid Schema although the idea is exactly the same for both.</p>
<p>An event contains some metadata and a data object. This data object can be anything the publisher wishes to publish.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;topic&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;subject&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;eventType&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;eventTime&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;data&#34;</span>:{
</span></span><span style="display:flex;"><span>      <span style="color:#960050;background-color:#1e0010">object-unique-to-each-publisher</span>
</span></span><span style="display:flex;"><span>    },
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;dataVersion&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;metadataVersion&#34;</span>: <span style="color:#960050;background-color:#1e0010">string</span>
</span></span><span style="display:flex;"><span> }
</span></span></code></pre></div><p>We can imagine that if we have a web app we might want to publish an event when a new user signs up. Here&rsquo;s an example of what an event might look like for this. This will obviously vary depending on your own use-case.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#e6db74">&#34;c03d293c-bf9b-439e-ba53-13e8435d96ef&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;subject&#34;</span>: <span style="color:#e6db74">&#34;/myApp/user/newUserSignedUp&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;data&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;joe.bloggs&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;userEmail&#34;</span>: <span style="color:#e6db74">&#34;joe@bloggs.com&#34;</span>
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;eventType&#34;</span>: <span style="color:#e6db74">&#34;MyNamespace.NewUserInfo&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;eventTime&#34;</span>: <span style="color:#e6db74">&#34;2018-12-17T09:24:15.6676522Z&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;dataVersion&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;metadataVersion&#34;</span>: <span style="color:#e6db74">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;topic&#34;</span>: <span style="color:#e6db74">&#34;/subscriptions/16481420-1984-497a-9aa7-902c0c153ae4/resourceGroups/someResourceGroup/providers/Microsoft.EventGrid/topics/newUserSignupTopic&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="debugging-with-postman">Debugging with Postman</h2>
<p><a href="https://www.getpostman.com/">Postman</a> is a well-known application that can be used for testing api endpoints and is great for constructing json and POSTing it to an endpoint. We can use postman to test an Event Grid triggered Azure Function as follows: -</p>
<p>Firstly, grab the url of the function you are trying to test. It usually takes the following form:</p>
<p><code>http://localhost:7071/runtime/webhooks/EventGrid?functionName=nameOfYourFunction</code></p>
<p>We can plug this in to a new postman message, as shown in the screen-shot below. Be sure and specify POST as the verb. Also, paste in the event you wish to send in the body tab (under raw).</p>
<p><img src="./postman_screenshot_1.png" alt="Message body"></p>
<p>Then we need to switch to the Headers tab and add 3 headers:</p>
<ul>
<li><code>Content-Type</code> = <code>application/json</code></li>
<li><code>aeg-event-type</code> = <code>Notification</code></li>
</ul>
<p><img src="./postman_screenshot_2.png" alt="Message headers"></p>
<p>That is it! Now set a breakpoint on your Azure Function solution and hit F5. Then send the Postman message and your breakpoint should be hit. When the Azure function completes it should return a 202 (Accepted) response back to Postman.</p>
<p>Depending on what you&rsquo;re testing, it&rsquo;s likely that you&rsquo;ll want to supply a new value for <code>id</code> and <code>eventTime</code> each time you send the message. It gets a bit tedious doing this by hand each time so you can utilise postman&rsquo;s <em>pre-request script</em> feature to set a couple of variables that we can substitute in the body of the message.</p>
<p><img src="./postman_screenshot_3.png" alt="Pre-request script"></p>
<p>The <code>id</code> and <code>eventTime</code> can be substituted as follows.</p>
<p><img src="./postman_screenshot_4.png" alt="Variable substitution"></p>
<h2 id="an-alternative-method-using-ngrok">An Alternative Method Using NGrok</h2>
<p>Sometimes it&rsquo;s desirable to test using events coming directly from an Event Grid topic. Microsoft has documented a way of doing this with ngrok (a third party service) which acts as an intermediary. This can be used to subscribe to an Event Grid topic and relay the event down to your localhost. You should be aware that there may be privacy concerns with this approach as your data will be passing through a middleman.</p>
<p><a href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-debug-event-grid-trigger-local">https://docs.microsoft.com/en-us/azure/azure-functions/functions-debug-event-grid-trigger-local</a></p>
<p>Thanks for reading.</p>
</section>

  
  

  
  
  
  
  <nav class="mt-24 flex rounded-lg bg-black/[3%] text-lg dark:bg-white/[8%]">
    
    <a
      class="flex w-1/2 items-center rounded-l-md p-6 pr-3 font-semibold no-underline hover:bg-black/[2%] dark:hover:bg-white/[3%]"
      href="http://localhost:1313/post/2018-03-29-octopus-deploy-slack-notifications/"
      ><span class="mr-1.5">←</span><span>Using an Azure function to get Octopus deployment notifications in Slack</span></a
    >
    
    
  </nav>
  
  

  
  
  <div class="mt-24" id="disqus_thread"></div>
  <script>
    const disqusShortname = 'blogilreavy';
    const script = document.createElement('script');
    script.src = 'https://' + disqusShortname + '.disqus.com/embed.js';
    script.setAttribute('data-timestamp', +new Date());
    document.head.appendChild(script);
  </script>
  

  
  

  


  
</article>


    </main>

    <footer
  class="opaco mx-auto flex h-[4.5rem] max-w-3xl items-center px-8 text-[0.9em] opacity-60"
>
  <div class="mr-auto">
    &copy; 2024
    <a class="link" href="http://localhost:1313/">Blogilreavy</a>
  </div>
  <a class="link mx-6" href="https://gohugo.io/" rel="noopener" target="_blank"
    >Powered by Hugo️️</a
  >️
  <a
    class="link"
    href="https://github.com/nanxiaobei/hugo-paper"
    rel="noopener"
    target="_blank"
    >✎ Paper</a
  >
</footer>

  </body>
</html>
